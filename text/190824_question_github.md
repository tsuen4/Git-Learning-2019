# GitHub を用いた共同開発

GitHub を用いて共同開発をする際、複数の人が master ブランチに変更を記録しようとすると、競合が発生してしまいます。
これは、 Git の機能を用いた開発フローを採用することで競合を防ぐことができます。
よく採用されている開発フローの 1 つに `GitHub Flow` というものがあります。

GitHub Flow とは、既存の git-flow の手順をシンプルにし、 GitHub のプルリクエスト機能を活かした開発フローです。
GitHub Flow は以下のようなフローで行われています。

- master ブランチのものは何であれデプロイ可能(利用可能な状態)である
- 新しい何かに取り組む際は、説明的な名前のブランチを master から作成する
- 作成したブランチにローカルでコミットし、サーバー上の同じ名前のブランチにも定期的に作業内容を push する
- フィードバックや助言が欲しい時や、ブランチをマージしてもよいと思ったときは、プルリクエストを作成する
- 他の誰かがレビューをして機能に OK を出してくれたら、あなたはコードを master へマージすることができる
- マージをして master へ push したら、直ちにデプロイをする

![GitHub-Flow](src/GitHub-Flow.png)

## 既存のプロジェクトに参加してみよう (GitHub Flow)

実際に GitHub Flow を用いて、既存のプロジェクトにファイルを追加してみましょう。
今回の作業は

- 既存のリポジトリのフォーク(fork)
- フォークしたものをクローン(clone)
- 編集用にブランチを作って作業
- ブランチをプッシュ(push)
- プルリクエスト(Pull Request)の作成

の順に行われます。

## GitHub Flow: フォークとクローン

GitHub 上にあるリポジトリをローカルにダウンロードするには、 `クローン(clone)` という操作をします。
しかし、他人のリポジトリに参加するためには、事前に `フォーク(fork)` する必要があります。
フォークすると、自分のアカウント上にリポジトリのコピーが生成され、それをクローンすることで編集が可能になります。

<!-- フォークとクローンの図を入れる -->

今回使用するリモートリポジトリは <https://github.com/hoge/hoge> です。
リンク先のリポジトリにアクセスして、右上の fork ボタンを押してフォークしましょう。
フォークが成功したら、 GitHub の自分のユーザーページにある、hogehoge というリポジトリにアクセスします。
そして、画面の右中央の `[Clone or download]` をクリックしてリポジトリの URL をコピーし、
`git clone <URL>` コマンドでローカルにクローンしましょう。
クローンしてきたたリポジトリには、自動的に `origin` という名前のリモート先が設定されています。

```bash
git clone コピーしたURL
```

## GitHub Flow: 元のリポジトリと接続

クローンした後の origin には、フォークされたリポジトリに対して設定されています。
元のリポジトリの変更も pull (取得)するために、別のリモート先を追加しましょう。
元のリポジトリに対しては `upstream` という名前をつけることが多いです。

```bash
git remote add upstream 元のリポジトリのURL
git remote -v # リモート先の確認 origin と upstream が表示されてたら OK!
```

### 間違えてしまった場合

- リモート先の URL を間違えてしまった場合
  - `git remote set-url リモート名 元のリポジトリのURL`
- リモート先の名前を変えたい場合
  - `git remote rename 元のリモート名 新しいリモート名`

## GitHub Flow: ブランチを作って作業

クローンに成功したら、カレントディレクトリにリポジトリ名のディレクトリが作成されます。
その中に入り、ブランチを切りましょう。今回は学籍番号でつけてみましょう。

```bash
cd <リポジトリ名>
git branch ht17a000 # 学籍番号の名前でブランチを作成
git checkout ht17a000 # 作成したブランチに切り替える
# 'git status' で現在のブランチの確認
```

ブランチを切り替えたら、 <https://github.com/hoge/hoge> の README.md に書いてある方法で作業を始めましょう。

## GitHub Flow: ブランチをプッシュ

作成・編集したファイルをコミットして、定期的にリモートリポジトリにブランチをプッシュしておきましょう。

```bash
# origin というリモート先に学籍番号の名前のブランチを送信
git push origin ht17a000
```

## GitHub Flow: プルリクエストの作成

プルリクエストは、助言が欲しい時や、ブランチをマージしても良いと思ったときに立てます。
立てるにはブランチをプッシュした後、フォーク元のリポジトリか自分のリポジトリを参照しに行きましょう。
画面上部に「最近プッシュされたブランチ」が表示されるので、
右側の `[Compare & pull request]` を選択して `プルリクエスト(pull request)` を作成しましょう。

### [Compare & pull request] が出ない場合

- ファイル一覧の上にある [New pull request] を選択
- Compare changes の下側の `[base: master] ← [compare: master]` の compare 側をプッシュしたブランチに変更

---

プルリクエストの作成画面では、タイトルと説明の入力欄が表示されます。
入力欄の下には、プルリクエストに関連するコミットとマージ先との差分が表示されます。

元リポジトリのオーナーにプル(確認)してもらうために、変更内容記入しましょう。
入力したら `[Create pull request]` を選択して完了です。
元リポジトリのオーナーにマージされたら、
あなたの変更が元のプロジェクトに反映されます！

<!-- プルリク受ける側も書こう -->
